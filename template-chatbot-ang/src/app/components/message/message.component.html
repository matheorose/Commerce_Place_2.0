<div class="message-row" [ngClass]="{ 'user': role === 'user', 'assistant': role === 'assistant' }">
  <div class="message-avatar">
    <app-bot-icon *ngIf="role === 'assistant'"></app-bot-icon>
    <app-user-icon *ngIf="role === 'user'"></app-user-icon>
  </div>

  <div class="message-bubble-wrapper">
    <div *ngIf="role === 'assistant' && thinkingTimeSeconds" class="message-thinking">
      Réponse en {{ thinkingTimeSeconds | number : '1.1-1' }} s
    </div>

    <div class="message-bubble" [ngClass]="{ 'assistant-bubble': role === 'assistant', 'user-bubble': role === 'user' }">
      <ng-container *ngIf="text; else projected">
        <div [innerHTML]="formattedText"></div>
      </ng-container>
      <ng-template #projected>
        <ng-content></ng-content>
      </ng-template>
      <div *ngIf="places?.length" class="flex flex-col gap-1 text-sm">
        <p class="text-zinc-500 dark:text-zinc-400">Commerces trouvés :</p>
        <ul class="space-y-1">
          <li *ngFor="let place of places" class="flex flex-col">
            <span class="font-medium text-zinc-800 dark:text-zinc-200">
              {{ place.name || 'Commerce' }}
            </span>
            <span class="text-xs text-zinc-500">
              {{ place.lat }} , {{ place.lon }}
            </span>
          </li>
        </ul>
      </div>
      <a
        *ngIf="viewUrl"
        class="inline-flex items-center justify-center text-sm px-3 py-1.5 border border-blue-500 rounded-md text-blue-600 hover:bg-blue-50 dark:text-blue-400 dark:border-blue-400"
        [href]="viewUrl"
        target="_blank"
        rel="noreferrer"
      >
        Ouvrir la carte
      </a>
    </div>
  </div>
</div>
